(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8465],{63353:function(e,t,i){Promise.resolve().then(i.bind(i,46379))},46379:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return C}});var n=i(57437),s=i(21925),a=i(70626),r=i(84534),o=i(80356),h=i(96733),l=i(42600),c=i(60584),u=i(54025);class g{constructor(e=Recast){if(this.bjsRECAST={},this.name="RecastJSPlugin",this._maximumSubStepCount=10,this._timeStep=1/60,this._timeFactor=1,this._worker=null,"function"==typeof e?a.Y.Error("RecastJS is not ready. Please make sure you await Recast() before using the plugin."):this.bjsRECAST=e,!this.isSupported()){a.Y.Error("RecastJS is not available. Please make sure you included the js file.");return}this.setTimeStep(),this._tempVec1=new this.bjsRECAST.Vec3,this._tempVec2=new this.bjsRECAST.Vec3}setWorkerURL(e){return!!window&&!!window.Worker&&(this._worker=new Worker(e),!0)}setTimeStep(e=1/60){this._timeStep=e}getTimeStep(){return this._timeStep}setMaximumSubStepCount(e=10){this._maximumSubStepCount=e}getMaximumSubStepCount(){return this._maximumSubStepCount}set timeFactor(e){this._timeFactor=Math.max(e,0)}get timeFactor(){return this._timeFactor}createNavMesh(e,t,i){let n,s,r;this._worker&&!i?a.Y.Warn("A worker is avaible but no completion callback. Defaulting to blocking navmesh creation"):!this._worker&&i&&a.Y.Warn("A completion callback is avaible but no worker. Defaulting to blocking navmesh creation"),this.navMesh=new this.bjsRECAST.NavMesh;let o=[],h=[],c=0;for(n=0;n<e.length;n++)if(e[n]){let t=e[n],i=t.getIndices();if(!i)continue;let a=t.getVerticesData(u.o.PositionKind,!1,!1);if(!a)continue;let g=[],m=t.computeWorldMatrix(!0);if(t.hasThinInstances){let e=t.thinInstanceGetWorldMatrices();for(let t=0;t<e.length;t++){let i=new l.y3;e[t].multiplyToRef(m,i),g.push(i)}}else g.push(m);for(let e=0;e<g.length;e++){let t=g[e];for(s=0;s<i.length;s++)o.push(i[s]+c);let n=l.P.Zero(),u=l.P.Zero();for(r=0;r<a.length;r+=3)l.P.FromArrayToRef(a,r,u),l.P.TransformCoordinatesToRef(u,t,n),h.push(n.x,n.y,n.z);c+=a.length/3}}if(this._worker&&i)this._worker.postMessage([h,c,o,o.length,t]),this._worker.onmessage=function(e){i(e.data)};else{let e=new this.bjsRECAST.rcConfig;e.cs=t.cs,e.ch=t.ch,e.borderSize=t.borderSize?t.borderSize:0,e.tileSize=t.tileSize?t.tileSize:0,e.walkableSlopeAngle=t.walkableSlopeAngle,e.walkableHeight=t.walkableHeight,e.walkableClimb=t.walkableClimb,e.walkableRadius=t.walkableRadius,e.maxEdgeLen=t.maxEdgeLen,e.maxSimplificationError=t.maxSimplificationError,e.minRegionArea=t.minRegionArea,e.mergeRegionArea=t.mergeRegionArea,e.maxVertsPerPoly=t.maxVertsPerPoly,e.detailSampleDist=t.detailSampleDist,e.detailSampleMaxError=t.detailSampleMaxError,this.navMesh.build(h,c,o,o.length,e)}}createDebugNavMesh(e){let t,i;let n=this.navMesh.getDebugNavMesh(),s=n.getTriangleCount(),a=[],r=[];for(t=0;t<3*s;t++)a.push(t);for(t=0;t<s;t++)for(i=0;i<3;i++){let e=n.getTriangle(t).getPoint(i);r.push(e.x,e.y,e.z)}let l=new h.Kj("NavMeshDebug",e),c=new o.x;return c.indices=a,c.positions=r,c.applyToMesh(l,!1),l}getClosestPoint(e){this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z;let t=this.navMesh.getClosestPoint(this._tempVec1);return new l.P(t.x,t.y,t.z)}getClosestPointToRef(e,t){this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z;let i=this.navMesh.getClosestPoint(this._tempVec1);t.set(i.x,i.y,i.z)}getRandomPointAround(e,t){this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z;let i=this.navMesh.getRandomPointAround(this._tempVec1,t);return new l.P(i.x,i.y,i.z)}getRandomPointAroundToRef(e,t,i){this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z;let n=this.navMesh.getRandomPointAround(this._tempVec1,t);i.set(n.x,n.y,n.z)}moveAlong(e,t){this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z,this._tempVec2.x=t.x,this._tempVec2.y=t.y,this._tempVec2.z=t.z;let i=this.navMesh.moveAlong(this._tempVec1,this._tempVec2);return new l.P(i.x,i.y,i.z)}moveAlongToRef(e,t,i){this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z,this._tempVec2.x=t.x,this._tempVec2.y=t.y,this._tempVec2.z=t.z;let n=this.navMesh.moveAlong(this._tempVec1,this._tempVec2);i.set(n.x,n.y,n.z)}_convertNavPathPoints(e){let t;let i=e.getPointCount(),n=[];for(t=0;t<i;t++){let i=e.getPoint(t);n.push(new l.P(i.x,i.y,i.z))}return n}computePath(e,t){this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z,this._tempVec2.x=t.x,this._tempVec2.y=t.y,this._tempVec2.z=t.z;let i=this.navMesh.computePath(this._tempVec1,this._tempVec2);return this._convertNavPathPoints(i)}computePathSmooth(e,t){this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z,this._tempVec2.x=t.x,this._tempVec2.y=t.y,this._tempVec2.z=t.z;let i=this.navMesh.computePathSmooth(this._tempVec1,this._tempVec2);return this._convertNavPathPoints(i)}createCrowd(e,t,i){return new m(this,e,t,i)}setDefaultQueryExtent(e){this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z,this.navMesh.setDefaultQueryExtent(this._tempVec1)}getDefaultQueryExtent(){let e=this.navMesh.getDefaultQueryExtent();return new l.P(e.x,e.y,e.z)}buildFromNavmeshData(e){let t=e.length*e.BYTES_PER_ELEMENT,i=this.bjsRECAST._malloc(t),n=new Uint8Array(this.bjsRECAST.HEAPU8.buffer,i,t);n.set(e);let s=new this.bjsRECAST.NavmeshData;s.dataPointer=n.byteOffset,s.size=e.length,this.navMesh=new this.bjsRECAST.NavMesh,this.navMesh.buildFromNavmeshData(s),this.bjsRECAST._free(n.byteOffset)}getNavmeshData(){let e=this.navMesh.getNavmeshData(),t=new Uint8Array(this.bjsRECAST.HEAPU8.buffer,e.dataPointer,e.size),i=new Uint8Array(e.size);return i.set(t),this.navMesh.freeNavmeshData(e),i}getDefaultQueryExtentToRef(e){let t=this.navMesh.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}dispose(){}addCylinderObstacle(e,t,i){return this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z,this.navMesh.addCylinderObstacle(this._tempVec1,t,i)}addBoxObstacle(e,t,i){return this._tempVec1.x=e.x,this._tempVec1.y=e.y,this._tempVec1.z=e.z,this._tempVec2.x=t.x,this._tempVec2.y=t.y,this._tempVec2.z=t.z,this.navMesh.addBoxObstacle(this._tempVec1,this._tempVec2,i)}removeObstacle(e){this.navMesh.removeObstacle(e)}isSupported(){return void 0!==this.bjsRECAST}getRandomSeed(){return this.bjsRECAST._getRandomSeed()}setRandomSeed(e){this.bjsRECAST._setRandomSeed(e)}}class m{constructor(e,t,i,n){this.recastCrowd={},this.transforms=[],this.agents=[],this.reachRadii=[],this._agentDestinationArmed=[],this._agentDestination=[],this._onBeforeAnimationsObserver=null,this.onReachTargetObservable=new c.y$,this.bjsRECASTPlugin=e,this.recastCrowd=new this.bjsRECASTPlugin.bjsRECAST.Crowd(t,i,this.bjsRECASTPlugin.navMesh.getNavMesh()),this._scene=n,this._onBeforeAnimationsObserver=n.onBeforeAnimationsObservable.add(()=>{this.update(.001*n.getEngine().getDeltaTime()*e.timeFactor)})}addAgent(e,t,i){let n=new this.bjsRECASTPlugin.bjsRECAST.dtCrowdAgentParams;n.radius=t.radius,n.height=t.height,n.maxAcceleration=t.maxAcceleration,n.maxSpeed=t.maxSpeed,n.collisionQueryRange=t.collisionQueryRange,n.pathOptimizationRange=t.pathOptimizationRange,n.separationWeight=t.separationWeight,n.updateFlags=7,n.obstacleAvoidanceType=0,n.queryFilterType=0,n.userData=0;let s=this.recastCrowd.addAgent(new this.bjsRECASTPlugin.bjsRECAST.Vec3(e.x,e.y,e.z),n);return this.transforms.push(i),this.agents.push(s),this.reachRadii.push(t.reachRadius?t.reachRadius:t.radius),this._agentDestinationArmed.push(!1),this._agentDestination.push(new l.P(0,0,0)),s}getAgentPosition(e){let t=this.recastCrowd.getAgentPosition(e);return new l.P(t.x,t.y,t.z)}getAgentPositionToRef(e,t){let i=this.recastCrowd.getAgentPosition(e);t.set(i.x,i.y,i.z)}getAgentVelocity(e){let t=this.recastCrowd.getAgentVelocity(e);return new l.P(t.x,t.y,t.z)}getAgentVelocityToRef(e,t){let i=this.recastCrowd.getAgentVelocity(e);t.set(i.x,i.y,i.z)}getAgentNextTargetPath(e){let t=this.recastCrowd.getAgentNextTargetPath(e);return new l.P(t.x,t.y,t.z)}getAgentNextTargetPathToRef(e,t){let i=this.recastCrowd.getAgentNextTargetPath(e);t.set(i.x,i.y,i.z)}getAgentState(e){return this.recastCrowd.getAgentState(e)}overOffmeshConnection(e){return this.recastCrowd.overOffmeshConnection(e)}agentGoto(e,t){this.recastCrowd.agentGoto(e,new this.bjsRECASTPlugin.bjsRECAST.Vec3(t.x,t.y,t.z));let i=this.agents.indexOf(e);i>-1&&(this._agentDestinationArmed[i]=!0,this._agentDestination[i].set(t.x,t.y,t.z))}agentTeleport(e,t){this.recastCrowd.agentTeleport(e,new this.bjsRECASTPlugin.bjsRECAST.Vec3(t.x,t.y,t.z))}updateAgentParameters(e,t){let i=this.recastCrowd.getAgentParameters(e);void 0!==t.radius&&(i.radius=t.radius),void 0!==t.height&&(i.height=t.height),void 0!==t.maxAcceleration&&(i.maxAcceleration=t.maxAcceleration),void 0!==t.maxSpeed&&(i.maxSpeed=t.maxSpeed),void 0!==t.collisionQueryRange&&(i.collisionQueryRange=t.collisionQueryRange),void 0!==t.pathOptimizationRange&&(i.pathOptimizationRange=t.pathOptimizationRange),void 0!==t.separationWeight&&(i.separationWeight=t.separationWeight),this.recastCrowd.setAgentParameters(e,i)}removeAgent(e){this.recastCrowd.removeAgent(e);let t=this.agents.indexOf(e);t>-1&&(this.agents.splice(t,1),this.transforms.splice(t,1),this.reachRadii.splice(t,1),this._agentDestinationArmed.splice(t,1),this._agentDestination.splice(t,1))}getAgents(){return this.agents}update(e){if(this.bjsRECASTPlugin.navMesh.update(),e<=l.kn)return;let t=this.bjsRECASTPlugin.getTimeStep(),i=this.bjsRECASTPlugin.getMaximumSubStepCount();if(t<=l.kn)this.recastCrowd.update(e);else{let n=Math.floor(e/t);i&&n>i&&(n=i),n<1&&(n=1);let s=e/n;for(let e=0;e<n;e++)this.recastCrowd.update(s)}for(let e=0;e<this.agents.length;e++){let t=this.agents[e],i=this.getAgentPosition(t);if(this.transforms[e].position=i,this._agentDestinationArmed[e]){let n=i.x-this._agentDestination[e].x,s=i.z-this._agentDestination[e].z,a=this.reachRadii[e],r=this._agentDestination[e].y-this.reachRadii[e],o=this._agentDestination[e].y+this.reachRadii[e],h=n*n+s*s;i.y>r&&i.y<o&&h<a*a&&(this._agentDestinationArmed[e]=!1,this.onReachTargetObservable.notifyObservers({agentIndex:t,destination:this._agentDestination[e]}))}}}setDefaultQueryExtent(e){let t=new this.bjsRECASTPlugin.bjsRECAST.Vec3(e.x,e.y,e.z);this.recastCrowd.setDefaultQueryExtent(t)}getDefaultQueryExtent(){let e=this.recastCrowd.getDefaultQueryExtent();return new l.P(e.x,e.y,e.z)}getDefaultQueryExtentToRef(e){let t=this.recastCrowd.getDefaultQueryExtent();e.set(t.x,t.y,t.z)}getCorners(e){let t;let i=this.recastCrowd.getCorners(e),n=i.getPointCount(),s=[];for(t=0;t<n;t++){let e=i.getPoint(t);s.push(new l.P(e.x,e.y,e.z))}return s}dispose(){this.recastCrowd.destroy(),this._scene.onBeforeAnimationsObservable.remove(this._onBeforeAnimationsObserver),this._onBeforeAnimationsObserver=null,this.onReachTargetObservable.clear()}}var d=i(2265),p=i(93551),x=i.n(p),f=i(72544),w=i(49084),y=i(83519);let _={cs:.2,ch:1,walkableSlopeAngle:0,walkableHeight:0,walkableClimb:0,walkableRadius:1,maxEdgeLen:12,maxSimplificationError:1.3,minRegionArea:8,mergeRegionArea:20,maxVertsPerPoly:6,detailSampleDist:6,detailSampleMaxError:15,borderSize:0,tileSize:10};function b(e,t,i){let n=(0,f.NR)("box"+Math.random(),{width:t.x,height:t.y,depth:t.z},i);return n.position=e,n}var v=i(53485);let P={radius:.1,height:.2,maxAcceleration:1e3,maxSpeed:10,collisionQueryRange:.5,pathOptimizationRange:0,separationWeight:1};var A=(0,d.forwardRef)(function(e,t){let{name:i,size:a=1,crowd:o,navigation:h}=e,l=i||"cat"+Math.random().toString(36).substring(2,15),c=(0,s.$rd)(),u=(0,d.useRef)(null);async function g(){var e;let{loop:t=!0,delay:i=100,count:n=0,onEnd:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};null===(e=u.current)||void 0===e||e.playAnimation(40,45,!s,i,null!=s?s:()=>{})}async function m(){var e;let{loop:t=!0,delay:i=100,count:n=0,onEnd:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};null===(e=u.current)||void 0===e||e.playAnimation(15,18,!s,i,null!=s?s:()=>{})}async function p(){var e;let{loop:t=!0,delay:i=100,count:n=0,onEnd:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};null===(e=u.current)||void 0===e||e.playAnimation(10,14,!s,i,null!=s?s:()=>{})}async function x(){var e;let{loop:t=!0,delay:i=100,count:n=0,onEnd:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};null===(e=u.current)||void 0===e||e.playAnimation(20,24,!s,i,null!=s?s:()=>{})}async function f(){var e;let{loop:t=!0,delay:i=100,count:n=0,onEnd:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};null===(e=u.current)||void 0===e||e.playAnimation(25,27,!s,i,null!=s?s:()=>{})}async function w(){var e;let{loop:t=!0,delay:i=100,count:n=0,onEnd:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};null===(e=u.current)||void 0===e||e.playAnimation(30,36,!s,i,null!=s?s:()=>{})}async function y(){var e;let{loop:t=!0,delay:i=100,count:n=0,onEnd:s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};null===(e=u.current)||void 0===e||e.playAnimation(0,9,!s,i,null!=s?s:()=>{})}return(0,d.useEffect)(()=>{let e;if(o){let t=new v.Y(l+"_transform");e=o.addAgent({x:0,y:0,z:0},P,t)}return()=>{null==o||o.removeAgent(e)}},[o,h,u.current]),(0,d.useEffect)(()=>{function e(){for(let e of o.getAgents())o.getAgentPositionToRef(e,u.current.position)}return u.current&&c.onBeforeRenderObservable.add(e),()=>{c.onBeforeRenderObservable.remove(e)}},[o,h,u.current]),(0,d.useEffect)(()=>{function e(e){if(32===e.type){let{pointerX:e,pointerY:t}=c,i=c.pickSprite(e,t);if(i.hit&&i.pickedSprite===u.current){(Math.random()>.5?x:f)({delay:500,onEnd:()=>{m()}});return}let n=c.pick(e,t);n.hit&&n.pickedMesh&&(console.log(o,n,h.getClosestPoint(n.pickedPoint)),o.agentGoto(0,h.getClosestPoint(n.pickedPoint)))}}return c.onPointerObservable.add(e),()=>{c.onPointerObservable.remove(e)}},[c]),(0,d.useImperativeHandle)(t,()=>({move:g,idle:m,sleep:p,clean:x,clean2:f,chick:w,eat:y,get sprite(){return u.current}}),[]),(0,n.jsx)("spriteManager",{name:l+"_spriteManager",imgUrl:"/cat/_next/static/media/sprite.ab9edf41.png",cellSize:256,capacity:1,isPickable:!0,children:(0,n.jsx)("sprite",{name:l+"_sprite",ref:u,cellIndex:16,position:new r.P(0,0,0),width:a,height:a,isPickable:!0})})});function R(){return(0,n.jsx)("plane",{name:"bg",width:32,height:65.5,position:new r.P(0,-1,0),rotation:new r.P(Math.PI/2,0,0),children:(0,n.jsx)("standardMaterial",{name:"bg-material",children:(0,n.jsx)("texture",{name:"bg-texture",url:"/cat/_next/static/media/ground-texture.dbd26a35.png",assignTo:"emissiveTexture"})})})}function S(){let e=function(e){let[t,i]=(0,d.useState)(null);return(0,d.useEffect)(()=>{let t,n;return e&&x()().then(s=>{t=new g(s);let a=(0,w.$6)("ground",{width:32,height:64},e);a.position.y=-1;let o=h.Kj.MergeMeshes([b(new r.P(0,0,14),new r.P(32,8,1),e),b(new r.P(-13,0,12),new r.P(4,4,4),e),b(new r.P(13,0,12),new r.P(4,4,4),e),b(new r.P(-10,0,5),new r.P(11,4,6),e),b(new r.P(9.5,0,3.5),new r.P(8,4,7),e),b(new r.P(-8.5,0,-3),new r.P(14,4,5),e),b(new r.P(-8.5,0,-15),new r.P(14,4,6),e),b(new r.P(10,0,-9),new r.P(11,4,4),e),b(new r.P(13,0,-14),new r.P(6,4,3),e),b(new r.P(11,0,-19),new r.P(9,4,2),e),b(new r.P(-6,0,-30),new r.P(18,4,2),e),b(new r.P(15,0,-27),new r.P(2,4,3),e),b(new r.P(13,0,-30),new r.P(6,4,2),e),a]),l=new y.K("block_mat",e);l.alpha=0,o.material=l,t.createNavMesh([o],_),i({crowd:n=t.createCrowd(5,.3,e),navigation:t})}),()=>{null==n||n.dispose(),null==t||t.dispose(),i(null)}},[e]),t}((0,s.$rd)()),t=(0,d.useRef)(null);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("arcRotateCamera",{name:"camera1",target:r.P.Zero(),alpha:-Math.PI/2,beta:0,radius:76,wheelPrecision:100}),(0,n.jsx)(R,{}),e&&(0,n.jsx)(A,{ref:t,name:"cat0",size:4,crowd:null==e?void 0:e.crowd,navigation:null==e?void 0:e.navigation})]})}function C(){return(0,n.jsx)("div",{className:"w-screen h-screen",children:(0,n.jsx)(s.D4V,{antialias:!0,adaptToDeviceRatio:!0,canvasId:"babylon-canvas",className:"w-full h-full !outline-none",children:(0,n.jsx)(s.xsS,{children:(0,n.jsx)(S,{})})})})}a.Y.LogLevels=0}},function(e){e.O(0,[192,2735,3105,4732,790,3918,6742,2971,2117,1744],function(){return e(e.s=63353)}),_N_E=e.O()}]);