"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8951],{98951:function(e,r,t){t.d(r,{DDSTools:function(){return y}});var a=t(39028),l=t(70626),f=t(13559),o=t(41587);function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}t(90385);let s=n("DXT1"),u=n("DXT3"),i=n("DXT5"),A=n("DX10");class y{static GetDDSInfo(e){let r=new Int32Array(e.buffer,e.byteOffset,31),t=new Int32Array(e.buffer,e.byteOffset,35),a=1;131072&r[2]&&(a=Math.max(1,r[7]));let l=r[21],f=l===A?t[32]:0,o=0;switch(l){case 113:o=2;break;case 116:o=1;break;case A:if(10===f){o=2;break}2===f&&(o=1)}return{width:r[4],height:r[3],mipmapCount:a,isFourCC:(4&r[20])==4,isRGB:(64&r[20])==64,isLuminance:(131072&r[20])==131072,isCube:(512&r[28])==512,isCompressed:l===s||l===u||l===i,dxgiFormat:f,textureType:o}}static _GetHalfFloatAsFloatRGBAArrayBuffer(e,r,t,a,l,f){let n=new Float32Array(a),s=new Uint16Array(l,t),u=0;for(let t=0;t<r;t++)for(let r=0;r<e;r++){let a=(r+t*e)*4;n[u]=(0,o.qZ)(s[a]),n[u+1]=(0,o.qZ)(s[a+1]),n[u+2]=(0,o.qZ)(s[a+2]),y.StoreLODInAlphaChannel?n[u+3]=f:n[u+3]=(0,o.qZ)(s[a+3]),u+=4}return n}static _GetHalfFloatRGBAArrayBuffer(e,r,t,a,l,f){if(y.StoreLODInAlphaChannel){let n=new Uint16Array(a),s=new Uint16Array(l,t),u=0;for(let t=0;t<r;t++)for(let r=0;r<e;r++){let a=(r+t*e)*4;n[u]=s[a],n[u+1]=s[a+1],n[u+2]=s[a+2],n[u+3]=(0,o.ay)(f),u+=4}return n}return new Uint16Array(l,t,a)}static _GetFloatRGBAArrayBuffer(e,r,t,a,l,f){if(y.StoreLODInAlphaChannel){let o=new Float32Array(a),n=new Float32Array(l,t),s=0;for(let t=0;t<r;t++)for(let r=0;r<e;r++){let a=(r+t*e)*4;o[s]=n[a],o[s+1]=n[a+1],o[s+2]=n[a+2],o[s+3]=f,s+=4}return o}return new Float32Array(l,t,a)}static _GetFloatAsHalfFloatRGBAArrayBuffer(e,r,t,a,l,f){let n=new Uint16Array(a),s=new Float32Array(l,t),u=0;for(let t=0;t<r;t++)for(let r=0;r<e;r++)n[u]=(0,o.ay)(s[u]),n[u+1]=(0,o.ay)(s[u+1]),n[u+2]=(0,o.ay)(s[u+2]),y.StoreLODInAlphaChannel?n[u+3]=(0,o.ay)(f):n[u+3]=(0,o.ay)(s[u+3]),u+=4;return n}static _GetFloatAsUIntRGBAArrayBuffer(e,r,t,l,f,o){let n=new Uint8Array(l),s=new Float32Array(f,t),u=0;for(let t=0;t<r;t++)for(let r=0;r<e;r++){let l=(r+t*e)*4;n[u]=255*(0,a.Clamp)(s[l]),n[u+1]=255*(0,a.Clamp)(s[l+1]),n[u+2]=255*(0,a.Clamp)(s[l+2]),y.StoreLODInAlphaChannel?n[u+3]=o:n[u+3]=255*(0,a.Clamp)(s[l+3]),u+=4}return n}static _GetHalfFloatAsUIntRGBAArrayBuffer(e,r,t,l,f,n){let s=new Uint8Array(l),u=new Uint16Array(f,t),i=0;for(let t=0;t<r;t++)for(let r=0;r<e;r++){let l=(r+t*e)*4;s[i]=255*(0,a.Clamp)((0,o.qZ)(u[l])),s[i+1]=255*(0,a.Clamp)((0,o.qZ)(u[l+1])),s[i+2]=255*(0,a.Clamp)((0,o.qZ)(u[l+2])),y.StoreLODInAlphaChannel?s[i+3]=n:s[i+3]=255*(0,a.Clamp)((0,o.qZ)(u[l+3])),i+=4}return s}static _GetRGBAArrayBuffer(e,r,t,a,l,f,o,n,s){let u=new Uint8Array(a),i=new Uint8Array(l,t),A=0;for(let t=0;t<r;t++)for(let r=0;r<e;r++){let a=(r+t*e)*4;u[A]=i[a+f],u[A+1]=i[a+o],u[A+2]=i[a+n],u[A+3]=i[a+s],A+=4}return u}static _ExtractLongWordOrder(e){return 0===e||255===e||-16777216===e?0:1+y._ExtractLongWordOrder(e>>8)}static _GetRGBArrayBuffer(e,r,t,a,l,f,o,n){let s=new Uint8Array(a),u=new Uint8Array(l,t),i=0;for(let t=0;t<r;t++)for(let r=0;r<e;r++){let a=(r+t*e)*3;s[i]=u[a+f],s[i+1]=u[a+o],s[i+2]=u[a+n],i+=3}return s}static _GetLuminanceArrayBuffer(e,r,t,a,l){let f=new Uint8Array(a),o=new Uint8Array(l,t),n=0;for(let t=0;t<r;t++)for(let r=0;r<e;r++){let a=r+t*e;f[n]=o[a],n++}return f}static UploadDDSLevels(e,r,t,a,o,n,c=-1,p,B=!0){let G,F,b,C=null;a.sphericalPolynomial&&(C=[]);let h=!!e.getCaps().s3tc;r.generateMipMaps=o;let m=new Int32Array(t.buffer,t.byteOffset,31),d,_,w,R=0,D,O=0,x=1;if(542327876!==m[0]){l.Y.Error("Invalid magic number in DDS header");return}if(!a.isFourCC&&!a.isRGB&&!a.isLuminance){l.Y.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");return}if(a.isCompressed&&!h){l.Y.Error("Compressed textures are not supported on this platform.");return}let U=m[22];D=m[1]+4;let k=!1;if(a.isFourCC)switch(d=m[21]){case s:x=8,O=33777;break;case u:x=16,O=33778;break;case i:x=16,O=33779;break;case 113:k=!0,U=64;break;case 116:k=!0,U=128;break;case A:{D+=20;let e=!1;switch(a.dxgiFormat){case 10:k=!0,U=64,e=!0;break;case 2:k=!0,U=128,e=!0;break;case 88:a.isRGB=!0,a.isFourCC=!1,U=32,e=!0}if(e)break}default:l.Y.Error(["Unsupported FourCC code:",String.fromCharCode(255&d,d>>8&255,d>>16&255,d>>24&255)]);return}let g=y._ExtractLongWordOrder(m[23]),L=y._ExtractLongWordOrder(m[24]),I=y._ExtractLongWordOrder(m[25]),S=y._ExtractLongWordOrder(m[26]);k&&(O=e._getRGBABufferInternalSizedFormat(a.textureType)),F=1,131072&m[2]&&!1!==o&&(F=Math.max(1,m[7]));let H=p||0,T=e.getCaps();for(let l=H;l<n;l++){for(b=0,_=m[4],w=m[3];b<F;++b){if(-1===c||c===b){let f=-1===c?b:0;if(!a.isCompressed&&a.isFourCC){r.format=5,R=_*w*4;let a=null;if(e._badOS||e._badDesktopOS||!T.textureHalfFloat&&!T.textureFloat)128===U?(a=y._GetFloatAsUIntRGBAArrayBuffer(_,w,t.byteOffset+D,R,t.buffer,f),C&&0==f&&C.push(y._GetFloatRGBAArrayBuffer(_,w,t.byteOffset+D,R,t.buffer,f))):64===U&&(a=y._GetHalfFloatAsUIntRGBAArrayBuffer(_,w,t.byteOffset+D,R,t.buffer,f),C&&0==f&&C.push(y._GetHalfFloatAsFloatRGBAArrayBuffer(_,w,t.byteOffset+D,R,t.buffer,f))),r.type=0;else{let e;let l=T.textureFloat&&(B&&T.textureFloatLinearFiltering||!B),o=T.textureHalfFloat&&(B&&T.textureHalfFloatLinearFiltering||!B),n=(128===U||64===U&&!o)&&l?1:(64===U||128===U&&!l)&&o?2:0,s=null;if(128===U)switch(n){case 1:e=y._GetFloatRGBAArrayBuffer,s=null;break;case 2:e=y._GetFloatAsHalfFloatRGBAArrayBuffer,s=y._GetFloatRGBAArrayBuffer;break;case 0:e=y._GetFloatAsUIntRGBAArrayBuffer,s=y._GetFloatRGBAArrayBuffer}else switch(n){case 1:e=y._GetHalfFloatAsFloatRGBAArrayBuffer,s=null;break;case 2:e=y._GetHalfFloatRGBAArrayBuffer,s=y._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:e=y._GetHalfFloatAsUIntRGBAArrayBuffer,s=y._GetHalfFloatAsFloatRGBAArrayBuffer}r.type=n,a=e(_,w,t.byteOffset+D,R,t.buffer,f),C&&0==f&&C.push(s?s(_,w,t.byteOffset+D,R,t.buffer,f):a)}a&&e._uploadDataToTextureDirectly(r,a,l,f)}else if(a.isRGB)r.type=0,24===U?(r.format=4,R=_*w*3,G=y._GetRGBArrayBuffer(_,w,t.byteOffset+D,R,t.buffer,g,L,I)):(r.format=5,R=_*w*4,G=y._GetRGBAArrayBuffer(_,w,t.byteOffset+D,R,t.buffer,g,L,I,S)),e._uploadDataToTextureDirectly(r,G,l,f);else if(a.isLuminance){let a=e._getUnpackAlignement(),o=_;R=Math.floor((_+a-1)/a)*a*(w-1)+o,G=y._GetLuminanceArrayBuffer(_,w,t.byteOffset+D,R,t.buffer),r.format=1,r.type=0,e._uploadDataToTextureDirectly(r,G,l,f)}else R=Math.max(4,_)/4*Math.max(4,w)/4*x,G=new Uint8Array(t.buffer,t.byteOffset+D,R),r.type=0,e._uploadCompressedDataToTextureDirectly(r,O,_,w,G,l,f)}D+=U?_*w*(U/8):R,_*=.5,w*=.5,_=Math.max(1,_),w=Math.max(1,w)}if(void 0!==p)break}C&&C.length>0?a.sphericalPolynomial=f.$.ConvertCubeMapToSphericalPolynomial({size:m[4],right:C[0],left:C[1],up:C[2],down:C[3],front:C[4],back:C[5],format:5,type:1,gammaSpace:!1}):a.sphericalPolynomial=void 0}}y.StoreLODInAlphaChannel=!1}}]);