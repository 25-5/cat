"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6156,8951],{16156:function(e,t,r){r.r(t),r.d(t,{_DDSTextureLoader:function(){return o}});var a=r(95332),l=r(98951);class o{constructor(){this.supportCascades=!0}loadCubeData(e,t,r,o){let n;let f=t.getEngine(),s=!1,i=1e3;if(Array.isArray(e))for(let r=0;r<e.length;r++){let a=e[r];n=l.DDSTools.GetDDSInfo(a),t.width=n.width,t.height=n.height,s=(n.isRGB||n.isLuminance||n.mipmapCount>1)&&t.generateMipMaps,f._unpackFlipY(n.isCompressed),l.DDSTools.UploadDDSLevels(f,t,a,n,s,6,-1,r),n.isFourCC||1!==n.mipmapCount?i=n.mipmapCount-1:f.generateMipMapsForCubemap(t)}else n=l.DDSTools.GetDDSInfo(e),t.width=n.width,t.height=n.height,r&&(n.sphericalPolynomial=new a.i),s=(n.isRGB||n.isLuminance||n.mipmapCount>1)&&t.generateMipMaps,f._unpackFlipY(n.isCompressed),l.DDSTools.UploadDDSLevels(f,t,e,n,s,6),n.isFourCC||1!==n.mipmapCount?i=n.mipmapCount-1:f.generateMipMapsForCubemap(t,!1);f._setCubeMapTextureParams(t,s,i),t.isReady=!0,t.onLoadedObservable.notifyObservers(t),t.onLoadedObservable.clear(),o&&o({isDDS:!0,width:t.width,info:n,data:e,texture:t})}loadData(e,t,r){let a=l.DDSTools.GetDDSInfo(e),o=(a.isRGB||a.isLuminance||a.mipmapCount>1)&&t.generateMipMaps&&Math.max(a.width,a.height)>>a.mipmapCount-1==1;r(a.width,a.height,o,a.isFourCC,()=>{l.DDSTools.UploadDDSLevels(t.getEngine(),t,e,a,o,1)})}}},98951:function(e,t,r){r.d(t,{DDSTools:function(){return A}});var a=r(39028),l=r(70626),o=r(13559),n=r(41587);function f(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}r(90385);let s=f("DXT1"),i=f("DXT3"),u=f("DXT5"),p=f("DX10");class A{static GetDDSInfo(e){let t=new Int32Array(e.buffer,e.byteOffset,31),r=new Int32Array(e.buffer,e.byteOffset,35),a=1;131072&t[2]&&(a=Math.max(1,t[7]));let l=t[21],o=l===p?r[32]:0,n=0;switch(l){case 113:n=2;break;case 116:n=1;break;case p:if(10===o){n=2;break}2===o&&(n=1)}return{width:t[4],height:t[3],mipmapCount:a,isFourCC:(4&t[20])==4,isRGB:(64&t[20])==64,isLuminance:(131072&t[20])==131072,isCube:(512&t[28])==512,isCompressed:l===s||l===i||l===u,dxgiFormat:o,textureType:n}}static _GetHalfFloatAsFloatRGBAArrayBuffer(e,t,r,a,l,o){let f=new Float32Array(a),s=new Uint16Array(l,r),i=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){let a=(t+r*e)*4;f[i]=(0,n.qZ)(s[a]),f[i+1]=(0,n.qZ)(s[a+1]),f[i+2]=(0,n.qZ)(s[a+2]),A.StoreLODInAlphaChannel?f[i+3]=o:f[i+3]=(0,n.qZ)(s[a+3]),i+=4}return f}static _GetHalfFloatRGBAArrayBuffer(e,t,r,a,l,o){if(A.StoreLODInAlphaChannel){let f=new Uint16Array(a),s=new Uint16Array(l,r),i=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){let a=(t+r*e)*4;f[i]=s[a],f[i+1]=s[a+1],f[i+2]=s[a+2],f[i+3]=(0,n.ay)(o),i+=4}return f}return new Uint16Array(l,r,a)}static _GetFloatRGBAArrayBuffer(e,t,r,a,l,o){if(A.StoreLODInAlphaChannel){let n=new Float32Array(a),f=new Float32Array(l,r),s=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){let a=(t+r*e)*4;n[s]=f[a],n[s+1]=f[a+1],n[s+2]=f[a+2],n[s+3]=o,s+=4}return n}return new Float32Array(l,r,a)}static _GetFloatAsHalfFloatRGBAArrayBuffer(e,t,r,a,l,o){let f=new Uint16Array(a),s=new Float32Array(l,r),i=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++)f[i]=(0,n.ay)(s[i]),f[i+1]=(0,n.ay)(s[i+1]),f[i+2]=(0,n.ay)(s[i+2]),A.StoreLODInAlphaChannel?f[i+3]=(0,n.ay)(o):f[i+3]=(0,n.ay)(s[i+3]),i+=4;return f}static _GetFloatAsUIntRGBAArrayBuffer(e,t,r,l,o,n){let f=new Uint8Array(l),s=new Float32Array(o,r),i=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){let l=(t+r*e)*4;f[i]=255*(0,a.Clamp)(s[l]),f[i+1]=255*(0,a.Clamp)(s[l+1]),f[i+2]=255*(0,a.Clamp)(s[l+2]),A.StoreLODInAlphaChannel?f[i+3]=n:f[i+3]=255*(0,a.Clamp)(s[l+3]),i+=4}return f}static _GetHalfFloatAsUIntRGBAArrayBuffer(e,t,r,l,o,f){let s=new Uint8Array(l),i=new Uint16Array(o,r),u=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){let l=(t+r*e)*4;s[u]=255*(0,a.Clamp)((0,n.qZ)(i[l])),s[u+1]=255*(0,a.Clamp)((0,n.qZ)(i[l+1])),s[u+2]=255*(0,a.Clamp)((0,n.qZ)(i[l+2])),A.StoreLODInAlphaChannel?s[u+3]=f:s[u+3]=255*(0,a.Clamp)((0,n.qZ)(i[l+3])),u+=4}return s}static _GetRGBAArrayBuffer(e,t,r,a,l,o,n,f,s){let i=new Uint8Array(a),u=new Uint8Array(l,r),p=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){let a=(t+r*e)*4;i[p]=u[a+o],i[p+1]=u[a+n],i[p+2]=u[a+f],i[p+3]=u[a+s],p+=4}return i}static _ExtractLongWordOrder(e){return 0===e||255===e||-16777216===e?0:1+A._ExtractLongWordOrder(e>>8)}static _GetRGBArrayBuffer(e,t,r,a,l,o,n,f){let s=new Uint8Array(a),i=new Uint8Array(l,r),u=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){let a=(t+r*e)*3;s[u]=i[a+o],s[u+1]=i[a+n],s[u+2]=i[a+f],u+=3}return s}static _GetLuminanceArrayBuffer(e,t,r,a,l){let o=new Uint8Array(a),n=new Uint8Array(l,r),f=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){let a=t+r*e;o[f]=n[a],f++}return o}static UploadDDSLevels(e,t,r,a,n,f,y=-1,c,m=!0){let h,C,d,G=null;a.sphericalPolynomial&&(G=[]);let B=!!e.getCaps().s3tc;t.generateMipMaps=n;let b=new Int32Array(r.buffer,r.byteOffset,31),D,F,_,w=0,g,R=0,L=1;if(542327876!==b[0]){l.Y.Error("Invalid magic number in DDS header");return}if(!a.isFourCC&&!a.isRGB&&!a.isLuminance){l.Y.Error("Unsupported format, must contain a FourCC, RGB or LUMINANCE code");return}if(a.isCompressed&&!B){l.Y.Error("Compressed textures are not supported on this platform.");return}let O=b[22];g=b[1]+4;let S=!1;if(a.isFourCC)switch(D=b[21]){case s:L=8,R=33777;break;case i:L=16,R=33778;break;case u:L=16,R=33779;break;case 113:S=!0,O=64;break;case 116:S=!0,O=128;break;case p:{g+=20;let e=!1;switch(a.dxgiFormat){case 10:S=!0,O=64,e=!0;break;case 2:S=!0,O=128,e=!0;break;case 88:a.isRGB=!0,a.isFourCC=!1,O=32,e=!0}if(e)break}default:l.Y.Error(["Unsupported FourCC code:",String.fromCharCode(255&D,D>>8&255,D>>16&255,D>>24&255)]);return}let x=A._ExtractLongWordOrder(b[23]),U=A._ExtractLongWordOrder(b[24]),k=A._ExtractLongWordOrder(b[25]),I=A._ExtractLongWordOrder(b[26]);S&&(R=e._getRGBABufferInternalSizedFormat(a.textureType)),C=1,131072&b[2]&&!1!==n&&(C=Math.max(1,b[7]));let M=c||0,T=e.getCaps();for(let l=M;l<f;l++){for(d=0,F=b[4],_=b[3];d<C;++d){if(-1===y||y===d){let o=-1===y?d:0;if(!a.isCompressed&&a.isFourCC){t.format=5,w=F*_*4;let a=null;if(e._badOS||e._badDesktopOS||!T.textureHalfFloat&&!T.textureFloat)128===O?(a=A._GetFloatAsUIntRGBAArrayBuffer(F,_,r.byteOffset+g,w,r.buffer,o),G&&0==o&&G.push(A._GetFloatRGBAArrayBuffer(F,_,r.byteOffset+g,w,r.buffer,o))):64===O&&(a=A._GetHalfFloatAsUIntRGBAArrayBuffer(F,_,r.byteOffset+g,w,r.buffer,o),G&&0==o&&G.push(A._GetHalfFloatAsFloatRGBAArrayBuffer(F,_,r.byteOffset+g,w,r.buffer,o))),t.type=0;else{let e;let l=T.textureFloat&&(m&&T.textureFloatLinearFiltering||!m),n=T.textureHalfFloat&&(m&&T.textureHalfFloatLinearFiltering||!m),f=(128===O||64===O&&!n)&&l?1:(64===O||128===O&&!l)&&n?2:0,s=null;if(128===O)switch(f){case 1:e=A._GetFloatRGBAArrayBuffer,s=null;break;case 2:e=A._GetFloatAsHalfFloatRGBAArrayBuffer,s=A._GetFloatRGBAArrayBuffer;break;case 0:e=A._GetFloatAsUIntRGBAArrayBuffer,s=A._GetFloatRGBAArrayBuffer}else switch(f){case 1:e=A._GetHalfFloatAsFloatRGBAArrayBuffer,s=null;break;case 2:e=A._GetHalfFloatRGBAArrayBuffer,s=A._GetHalfFloatAsFloatRGBAArrayBuffer;break;case 0:e=A._GetHalfFloatAsUIntRGBAArrayBuffer,s=A._GetHalfFloatAsFloatRGBAArrayBuffer}t.type=f,a=e(F,_,r.byteOffset+g,w,r.buffer,o),G&&0==o&&G.push(s?s(F,_,r.byteOffset+g,w,r.buffer,o):a)}a&&e._uploadDataToTextureDirectly(t,a,l,o)}else if(a.isRGB)t.type=0,24===O?(t.format=4,w=F*_*3,h=A._GetRGBArrayBuffer(F,_,r.byteOffset+g,w,r.buffer,x,U,k)):(t.format=5,w=F*_*4,h=A._GetRGBAArrayBuffer(F,_,r.byteOffset+g,w,r.buffer,x,U,k,I)),e._uploadDataToTextureDirectly(t,h,l,o);else if(a.isLuminance){let a=e._getUnpackAlignement(),n=F;w=Math.floor((F+a-1)/a)*a*(_-1)+n,h=A._GetLuminanceArrayBuffer(F,_,r.byteOffset+g,w,r.buffer),t.format=1,t.type=0,e._uploadDataToTextureDirectly(t,h,l,o)}else w=Math.max(4,F)/4*Math.max(4,_)/4*L,h=new Uint8Array(r.buffer,r.byteOffset+g,w),t.type=0,e._uploadCompressedDataToTextureDirectly(t,R,F,_,h,l,o)}g+=O?F*_*(O/8):w,F*=.5,_*=.5,F=Math.max(1,F),_=Math.max(1,_)}if(void 0!==c)break}G&&G.length>0?a.sphericalPolynomial=o.$.ConvertCubeMapToSphericalPolynomial({size:b[4],right:G[0],left:G[1],up:G[2],down:G[3],front:G[4],back:G[5],format:5,type:1,gammaSpace:!1}):a.sphericalPolynomial=void 0}}A.StoreLODInAlphaChannel=!1}}]);